<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Reset Password — THE ART OF WEB</title>
  <link href="styles.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body.arabic { font-family: 'Cairo', sans-serif; }
    body { display:flex; justify-content:center; align-items:center; min-height:100vh; background:#f7f7f7; }
    .reset-container { background:#fff; padding:30px; border-radius:12px; max-width:400px; width:90%; box-shadow:0 10px 30px rgba(0,0,0,0.2); text-align:center; }
    h2 { margin-bottom:20px; }
    .field { margin-bottom:15px; }
    input { width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; }
    button { width:100%; padding:12px; border:none; border-radius:6px; background:#f6b042; color:#fff; font-weight:bold; cursor:pointer; }
    button:hover { background:#e59c00; }
    .message { margin-top:15px; font-size:14px; color:green; }
    .error { color:red; }
  </style>
</head>
<body>

<div class="reset-container">
  <h2>Reset Your Password</h2>
  <div class="field">
    <input type="password" id="new-password" placeholder="New Password">
  </div>
  <div class="field">
    <input type="password" id="confirm-password" placeholder="Confirm Password">
  </div>
  <button id="reset-password-btn">Reset Password</button>
  <div class="message" id="msg"></div>
</div>

<script>
  // Get the email from URL query params
  const params = new URLSearchParams(window.location.search);
  const email = params.get("email");

  const msgEl = document.getElementById("msg");
  const resetBtn = document.getElementById("reset-password-btn");

  resetBtn.addEventListener("click",()=>{
    const newPass = document.getElementById("new-password").value.trim();
    const confirmPass = document.getElementById("confirm-password").value.trim();
    msgEl.textContent = "";
    msgEl.classList.remove("error");

    if(!newPass || !confirmPass){ 
      msgEl.textContent = "Please fill both fields."; 
      msgEl.classList.add("error");
      return;
    }
    if(newPass !== confirmPass){
      msgEl.textContent = "Passwords do not match.";
      msgEl.classList.add("error");
      return;
    }
    if(!/^(?=.*[0-9])(?=.{8,})/.test(newPass)){
      msgEl.textContent = "Password must be at least 8 characters with a number.";
      msgEl.classList.add("error");
      return;
    }

    // Update user password in localStorage
    let users = JSON.parse(localStorage.getItem("signupUsers")||"[]");
    let user = users.find(u => u.email === email);
    if(!user){
      msgEl.textContent = "Email not found. Maybe signed up with another email.";
      msgEl.classList.add("error");
      return;
    }
    user.password = newPass;
    localStorage.setItem("signupUsers", JSON.stringify(users));
    localStorage.setItem("loggedUser", JSON.stringify(user));
    msgEl.textContent = "✅ Password successfully reset! Redirecting to login...";
    
    setTimeout(()=>{ window.location.href = "index.html"; }, 2000);
  });
</script>

</body>
</html>
